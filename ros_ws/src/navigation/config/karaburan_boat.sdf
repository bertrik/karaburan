<?xml version="1.0"?>
<sdf version="1.10">
  <model name="karaburan">
    <static>false</static>
    <pose>0 0 0 0 0 0</pose>

    <link name="hull">
      <collision name="hull_col">
        <geometry><box><size>0.5 0.25 0.13</size></box></geometry>
        <pose>0 0 0.065 0 0 0</pose>
      </collision>
      <visual name="hull_vis">
        <geometry><box><size>0.5 0.25 0.13</size></box></geometry>
        <pose>0 0 0.065 0 0 0</pose>
      </visual>

      <!-- Massa/inertie van de romp; COM iets lager dan midden -->
      <inertial>
        <pose>0 0 -0.02 0 0 0</pose>
        <mass>2.0</mass>
        <inertia>
          <ixx>0.0666667</ixx>
          <iyy>0.1333333</iyy>
          <izz>0.1733333</izz>
          <ixy>0</ixy><ixz>0</ixz><iyz>0</iyz>
        </inertia>
      </inertial>
      <velocity_decay>
        <linear>0.02</linear>
        <angular>0.15</angular>
      </velocity_decay>

      <sensor name="imu_sensor" type="imu">
        <gz_frame_id>imu_link</gz_frame_id>
        <always_on>1</always_on>
        <update_rate>30</update_rate>
        <visualize>false</visualize>
	<topic>/imu/data</topic>
      </sensor>
      <sensor name="gps_sensor" type="navsat">
        <gz_frame_id>gps_link</gz_frame_id>
        <always_on>1</always_on>
        <update_rate>5</update_rate>
	<topic>/fix/valid</topic>
      </sensor>
      <!-- 2D LiDAR -->
      <sensor name="lidar_sensor" type="gpu_lidar">
        <gz_frame_id>lidar_link</gz_frame_id>
        <topic>/scan</topic>
        <update_rate>10</update_rate>
        <ray>
          <scan>
            <horizontal>
              <samples>720</samples>
              <resolution>1</resolution>
              <min_angle>-1.570796</min_angle>  <!-- -90° -->
              <max_angle> 1.570796</max_angle>  <!--  +90° -->
            </horizontal>
            <vertical>
              <samples>1</samples>
              <resolution>1</resolution>
              <min_angle>0</min_angle>
              <max_angle>0</max_angle>
            </vertical>
          </scan>
          <range>
            <min>0.1</min>
            <max>50.0</max>
            <resolution>0.01</resolution>
          </range>
        </ray>
        <always_on>1</always_on>
        <visualize>true</visualize>
      </sensor>
    </link>

      <!-- LEFT PROPELLER (link + joint) -->
  <link name="left_prop">
    <inertial>
      <pose>0 0 0 0 0 0</pose>
      <mass>0.05</mass>
      <inertia>
        <ixx>1e-5</ixx><iyy>1e-5</iyy><izz>1e-5</izz>
        <ixy>0</ixy><ixz>0</ixz><iyz>0</iyz>
      </inertia>
    </inertial>
    <visual name="left_prop_vis">
      <geometry><cylinder><radius>0.025</radius><length>0.02</length></cylinder></geometry>
      <!-- achter de romp (x<0), bakboord (y>0), op halve hoogte z=0.10 -->
      <pose>-0.25 0.11 0.065 0 0 0</pose>
    </visual>
    <!-- GEEN collision -> geen extra drijfkracht -->
  </link>

  <joint name="left_prop_joint" type="revolute">
    <parent>hull</parent>
    <child>left_prop</child>
    <!-- as = +X in child-frame: “vooruit” is +thrust -->
    <pose>-0.25 0.11 0.065 0 0 0</pose>
    <axis>
      <xyz>1 0 0</xyz>
      <limit><lower>-1e16</lower><upper>1e16</upper></limit>
    </axis>
  </joint>

  <!-- RIGHT PROPELLER -->
  <link name="right_prop">
    <inertial>
      <pose>0 0 0 0 0 0</pose>
      <mass>0.05</mass>
      <inertia>
        <ixx>1e-5</ixx><iyy>1e-5</iyy><izz>1e-5</izz>
        <ixy>0</ixy><ixz>0</ixz><iyz>0</iyz>
      </inertia>
    </inertial>
    <visual name="right_prop_vis">
      <geometry><cylinder><radius>0.025</radius><length>0.02</length></cylinder></geometry>
      <pose>-0.25 -0.11 0.065 0 0 0</pose>
    </visual>
  </link>

  <joint name="right_prop_joint" type="revolute">
    <parent>hull</parent>
    <child>right_prop</child>
    <pose>-0.25 -0.11 0.065 0 0 0</pose>
    <axis>
      <xyz>1 0 0</xyz>
      <limit><lower>-1e16</lower><upper>1e16</upper></limit>
    </axis>
  </joint>

  <!-- Thruster plugins: 1 per joint -->
  <plugin filename="gz-sim-thruster-system" name="gz::sim::systems::Thruster">
    <namespace>karaburan</namespace>
    <joint_name>left_prop_joint</joint_name>
    <fluid_density>1000</fluid_density>
    <propeller_diameter>0.025</propeller_diameter>
    <thrust_coefficient>0.0004</thrust_coefficient>
    <!-- standaard: cmd_thrust (N), joint wordt visueel gesponnen -->
  </plugin>

  <plugin filename="gz-sim-thruster-system" name="gz::sim::systems::Thruster">
    <namespace>karaburan</namespace>
    <joint_name>right_prop_joint</joint_name>
    <fluid_density>1000</fluid_density>
    <propeller_diameter>0.025</propeller_diameter>
    <thrust_coefficient>0.0004</thrust_coefficient>
  </plugin>


    <plugin name="gz::sim::systems::Hydrodynamics" filename="gz-sim-hydrodynamics-system">
      <link_name>hull</link_name>
      <water_density>998</water_density>
      <disable_coriolis>true</disable_coriolis>
      <disable_added_mass>true</disable_added_mass>

      <xDotU>0</xDotU> <yDotV>0</yDotV> <zDotW>0</zDotW>
      <kDotP>0</kDotP> <mDotQ>0</mDotQ> <nDotR>0</nDotR>

      <xU>-2.0</xU>  <yV>-3.0</yV>  <zW>-80.0</zW>

      <xUabsU>-0.6</xUabsU>  <yVabsV>-1.0</yVabsV>  <zWabsW>-9.0</zWabsW>

      <kP>-4.0</kP>      <kPabsP>-10.0</kPabsP>   <!-- roll -->
      <mQ>-4.0</mQ>      <mQabsQ>-10.0</mQabsQ>   <!-- pitch -->
      <nR>-2.0</nR>      <nRabsR>-3.0</nRabsR>   <!-- yaw -->
    </plugin>
  </model>
</sdf>

